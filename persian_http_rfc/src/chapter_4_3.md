# Authoritative Access

دسترسی معتبر به معنای ارجاع به یک شناسه خاص است، به‌منظور دسترسی به منبع شناسایی‌شده، به‌گونه‌ای که کلاینت آن را معتبر می‌داند (کنترل‌شده توسط مالک منبع). فرآیند تعیین اینکه آیا دسترسی مجاز است یا نه توسط scheme URI تعریف می‌شود و اغلب از داده‌های موجود در اجزای URI، مانند بخش authority زمانی که از نحو عمومی استفاده می‌شود، بهره می‌برد. با این حال، دسترسی معتبر محدود به مکانیزم شناسایی‌شده نیست. بخش ۴.۳.۱ مفهوم origin را به‌عنوان کمکی برای چنین استفاده‌هایی تعریف می‌کند و زیر‌بخش‌های بعدی توضیح می‌دهند که چگونه می‌توان تأسیس کرد که یک همتا حق نمایندگی یک origin را دارد. برای ملاحظات امنیتی مربوط به تأسیس authority، به بخش ۱۷.۱ رجوع شود.

## 4.3.1. URI Origin

"مبدأ" برای یک URI مشخص، سه‌گانه‌ای است از scheme، host و port، پس از نرمال‌سازی scheme و host به حروف کوچک و حذف صفرهای پیشوندی از port. اگر port در URI ذکر نشده باشد، از پورت پیش‌فرض مربوط به آن scheme استفاده می‌شود. برای مثال، URI:

> <https://Example.Com/happy.js>

مبدا خواهد داشت:

> { "https", "example.com", "443" }

که همچنین می‌توان آن را به‌صورت پیشوند نرمال‌شده URI با حضور همیشگی پورت توصیف کرد:

> <https://example.com:443>

هر origin فضای نام (namespace) خاص خود را تعریف می‌کند و کنترل می‌کند که شناسه‌های درون آن فضا چگونه به منابع نگاشت شوند. در نتیجه، نحوه پاسخ‌گویی origin به درخواست‌های معتبر، به‌صورت مداوم در طول زمان، معنایی را شکل می‌دهد که کاربران با URI مرتبط می‌دانند، و میزان مفید بودن آن معنا چیزی است که در نهایت این مکانیزم‌ها را به منبعی برای ارجاع و دسترسی کاربران در آینده تبدیل می‌کند. دو origin متمایز هستند اگر در scheme، host یا port تفاوت داشته باشند. حتی اگر تأیید شود که یک موجودیت مشترک دو origin متمایز را کنترل می‌کند، فضای نام آن دو origin همچنان متمایز هستند مگر اینکه توسط یک سرور معتبر برای آن origin به‌صراحت به یکدیگر ارجاع داده شوند. همچنین، مفهوم origin در HTML و پروتکل‌های مرتبط با وب نیز به کار می‌رود، که خارج از حوزه این سند بوده و در [RFC6454] توضیح داده شده است.

## 4.3.2. http Origins

اگرچه HTTP مستقل از پروتکل انتقال است، scheme ‏"http" (بخش ۴.۲.۱) به‌طور خاص برای مرتبط‌کردن اختیار (authority) با کسی است که کنترل‌کننده‌ی سرور origin شنونده‌ی اتصالات TCP روی پورت مشخص‌شده‌ی میزبان تعیین‌شده در مؤلفه‌ی authority است. این نوع از authority بسیار ضعیف تلقی می‌شود، زیرا وابسته به مکانیزم‌های client-specific برای name resolution و ارتباطاتی است که ممکن است در برابر حمله‌کننده‌ای در مسیر امن نباشند. با این‌ حال، این حداقلِ کافی برای پیوند دادن شناسه‌های "http" به یک سرور origin به‌منظور resolution سازگار در یک محیط قابل‌اعتماد به‌شمار می‌آید.

اگر شناسه‌ی میزبان (host identifier) به‌صورت آدرس IP ارائه شود، سرور origin شنونده‌ای است (در صورت وجود) که روی آن پورت TCP مشخص‌شده در همان آدرس IP گوش می‌دهد. اگر host یک نام ثبت‌شده باشد، آن نام به‌عنوان یک شناسه‌ی غیرمستقیم برای استفاده در یک سرویس name resolution مانند DNS عمل می‌کند تا آدرسی برای سرور origin مناسب بیابد.

هنگامی‌که یک URI از نوع "http" در زمینه‌ای استفاده شود که دسترسی به منبع مشخص‌شده را می‌طلبد، یک کلاینت ممکن است برای دسترسی تلاش کند؛ به این صورت که شناسه‌ی میزبان را به آدرس IP resolve کند، اتصال TCP با آن آدرس در پورت مشخص برقرار کند، و از طریق آن اتصال، یک پیام درخواست HTTP ارسال کند که شامل هدف درخواستی (request target) باشد که با URI هدف کلاینت مطابقت دارد (بخش ۷.۱). اگر سرور به چنین درخواستی با یک پاسخ نهایی HTTP (نه موقت) پاسخ دهد، همان‌طور که در بخش ۱۵ توصیف شده، آن پاسخ به‌عنوان پاسخ معتبر به درخواست کلاینت در نظر گرفته می‌شود.

توجه داشته باشید که روش بالا تنها روش دریافت پاسخ معتبر نیست، و همچنین به این معنا نیست که همیشه پاسخ معتبر لازم است (نگاه کنید به \[CACHING]). به‌عنوان مثال، فیلد هدر Alt-Svc ‏\[ALTSVC] به سرور origin اجازه می‌دهد سرویس‌های دیگری را که برای آن origin نیز معتبر هستند، معرفی کند. همچنین ممکن است دسترسی به منابع با شناسه‌ی "http" توسط پروتکل‌هایی فراهم شود که خارج از حوزه‌ی این سند هستند.

## 4.3.3. https Origins

طرح "https" (بخش ۴.۲.۲) اختیار (authority) را براساس توانایی سرور در استفاده از کلید خصوصی مربوط به یک گواهی‌نامه که کلاینت آن را برای سرور origin مشخص‌شده معتبر می‌داند، اختصاص می‌دهد. کلاینت معمولاً به زنجیره‌ای از اعتماد (chain of trust) که از یک نقطه اعتماد (trust anchor) از پیش تعیین‌شده یا پیکربندی‌شده شروع می‌شود تکیه می‌کند تا یک گواهی را معتبر بداند (بخش ۴.۳.۴).

در HTTP/1.1 و نسخه‌های قبلی، کلاینت تنها زمانی اختیار را به یک سرور نسبت می‌دهد که آن‌ها از طریق یک اتصال موفق و امن شده مشخصاً به میزبان URI origin در حال ارتباط باشند. ایجاد اتصال و تأیید گواهی به‌عنوان اثبات اختیار در نظر گرفته می‌شود.

در HTTP/2 و HTTP/3، کلاینت زمانی اختیار را به سرور نسبت می‌دهد که اتصال امن و موفقی برقرار شده باشد و میزبان origin در URI با هر یک از میزبان‌های موجود در گواهی سرور مطابقت داشته باشد و کلاینت باور داشته باشد که می‌تواند به آن میزبان برای آن URI اتصال برقرار کند. در عمل، کلاینت معمولاً یک درخواست DNS ارسال می‌کند تا بررسی کند که میزبان origin همان آدرس IP سروری را دارد که اتصال با آن برقرار شده است. این محدودیت می‌تواند با ارسال یک فریم ORIGIN معادل از سوی سرور origin برداشته شود ‏\[RFC8336].

مقدار host و port مربوط به هدف درخواست (request target) در هر درخواست HTTP منتقل می‌شود و origin را مشخص کرده و آن را از سایر فضای‌نام‌هایی که ممکن است توسط همان سرور کنترل شوند، متمایز می‌سازد (بخش ۷.۲).

این مسئولیت بر عهده‌ی origin است که اطمینان حاصل کند هر سرویسی که اختیار کلید خصوصی گواهی آن را دارد، به همان اندازه مسئول مدیریت فضای‌نام‌های "https" مربوطه باشد یا حداقل آماده باشد تا درخواست‌هایی را که به‌نظر اشتباه هدایت شده‌اند، رد کند (بخش ۷.۴).

ممکن است یک سرور origin با وجود داشتن اختیار، تمایلی به پردازش درخواست‌ها برای URIهای خاص نداشته باشد. برای مثال، زمانی که یک میزبان خدمات مختلفی را روی پورت‌های متفاوت (مثلاً ۴۴۳ و ۸۰۰۰) اجرا می‌کند، بررسی URI هدف در سرور origin حتی پس از امن‌سازی اتصال ضروری است، زیرا یک مهاجم شبکه ممکن است اتصال‌ها برای یک پورت را به گونه‌ای هدایت کند که در پورت دیگری دریافت شوند. در صورت عدم بررسی URI هدف، ممکن است چنین مهاجمی بتواند پاسخ مربوط به یک URI خاص (مثلاً `"https://example.com/foo"`) را با پاسخی به ظاهر معتبر از پورت دیگر (مثلاً `"https://example.com:8000/foo"`) جایگزین کند.

توجه داشته باشید که طرح "https" برای تعیین اختیار به TCP و شماره پورت متصل‌شده وابسته نیست، زیرا هر دو در خارج از ارتباط امن قرار دارند و نمی‌توان به‌عنوان شواهد قطعی به آن‌ها اعتماد کرد. بنابراین، ارتباط HTTP ممکن است از طریق هر کانالی که طبق تعریف در بخش ۴.۲.۲ امن شده باشد، صورت گیرد؛ از جمله پروتکل‌هایی که از TCP استفاده نمی‌کنند.

زمانی که از یک URI "https" در زمینه‌ای استفاده شود که نیاز به دسترسی به منبع مشخص‌شده دارد، کلاینت می‌تواند تلاش کند از طریق حل نام میزبان به یک آدرس IP، ایجاد اتصال TCP به آن آدرس در پورت مشخص‌شده، ایمن‌سازی کامل اتصال با آغاز موفقیت‌آمیز TLS روی TCP با حفظ محرمانگی و تمامیت، و ارسال یک پیام درخواست HTTP شامل هدف درخواستی که با URI هدف کلاینت مطابقت دارد (بخش ۷.۱)، به منبع دسترسی یابد.

اگر سرور به چنین درخواستی با یک پیام پاسخ HTTP نهایی (و نه موقتی) پاسخ دهد، همان‌طور که در بخش ۱۵ توصیف شده، آن پاسخ به‌عنوان پاسخ معتبر به درخواست کلاینت در نظر گرفته می‌شود. با این حال، این روش تنها راه دریافت پاسخ معتبر نیست و همچنین به این معنا نیست که همیشه نیاز به پاسخ معتبر وجود دارد (نگاه کنید به \[CACHING]).

## 4.3.4. https Certificate Verification

برای ایجاد یک اتصال امن به منظور بازیابی (dereference) یک URI، کلاینت باید اطمینان حاصل کند که هویت سرویس با سرور origin مربوط به URI تطابق قابل قبولی دارد. تأیید گواهی‌نامه (certificate verification) برای جلوگیری از جعل سرور توسط مهاجم میان‌راهی (on-path attacker) یا مهاجمی که کنترل نام‌گذاری (name resolution) را در دست دارد، ضروری است. این فرایند مستلزم آن است که کلاینت به مجموعه‌ای از پایگاه‌های اعتماد (trust anchors) مجهز باشد.

به طور کلی، کلاینت باید هویت سرویس را طبق فرایند تأییدی که در بخش ۶ از \[RFC6125] تعریف شده بررسی کند. کلاینت باید یک هویت مرجع (reference identity) بر اساس میزبان (host) سرویس بسازد: اگر میزبان یک آدرس IP واقعی باشد (بخش ۴.۳.۵)، هویت مرجع از نوع IP-ID است؛ در غیر این صورت، میزبان یک نام است و هویت مرجع از نوع DNS-ID خواهد بود. کلاینت‌ها نباید از هویت مرجع از نوع CN-ID استفاده کنند. همان‌طور که در بخش ۶.۲.۱ از \[RFC6125] ذکر شده، کلاینت‌های قدیمی ممکن است از CN-ID استفاده کنند.

کلاینت ممکن است به‌طور خاص طوری پیکربندی شده باشد که شکل جایگزینی از تأیید هویت سرور را بپذیرد. برای مثال، کلاینتی که به سروری با آدرس و نام دامنه پویا متصل می‌شود، ممکن است انتظار داشته باشد که سرویس گواهی‌نامه‌ای خاص ارائه دهد (یا گواهی‌نامه‌ای که با هویت مرجعی که خارج از URI تعریف شده مطابقت دارد) به‌جای آنکه با origin هدف مطابقت داشته باشد.

در موارد خاص، ممکن است مناسب باشد که کلاینت به‌طور کلی هویت سرور را نادیده بگیرد، اما باید دانست که این کار ارتباط را در معرض حملات فعال قرار می‌دهد.

اگر گواهی‌نامه برای origin مربوط به URI هدف معتبر نباشد، عامل کاربر (user agent) باید یا پیش از ادامه تأیید صریح کاربر را دریافت کند (نگاه کنید به بخش ۳.۵) یا ارتباط را با خطای گواهی‌نامه نامعتبر قطع کند. کلاینت‌های خودکار باید این خطا را در یک لاگ ممیزی مناسب ثبت کنند (در صورت وجود) و بهتر است ارتباط را خاتمه دهند (با خطای گواهی‌نامه نامعتبر). این کلاینت‌های خودکار می‌توانند یک تنظیم اختیاری برای غیرفعال‌سازی این بررسی داشته باشند، اما حتماً باید گزینه‌ای برای فعال‌سازی آن ارائه دهند.

## 4.3.5. IP-ID Reference Identity

سرویسی که در فیلد "host" از یک URI با طرح "https" با یک آدرس IP به‌صورت literal مشخص شده است، دارای هویت مرجع از نوع IP-ID است. یک آدرس IP نسخه ۴ از قاعده ABNF با عنوان "IPv4address" پیروی می‌کند و آدرس IP نسخه ۶ از تولید "IP-literal" با گزینه "IPv6address" استفاده می‌کند؛ به بخش ۳.۲.۲ از \[URI] مراجعه کنید.

یک هویت مرجع از نوع IP-ID شامل بایت‌های رمزگشایی‌شدهٔ آدرس IP است. آدرس IPv4 شامل ۴ اکتت و آدرس IPv6 شامل ۱۶ اکتت است. استفاده از IP-ID برای هیچ نسخهٔ دیگری از IP تعریف نشده است.

گزینهٔ iPAddress در افزونهٔ subjectAltName گواهی‌نامه نسخهٔ IP را به‌طور صریح مشخص نمی‌کند و برای تشخیص نسخه به طول آدرس متکی است؛ به بخش ۴.۲.۱.۶ از \[RFC5280] مراجعه کنید.

یک هویت مرجع از نوع IP-ID در صورتی مطابقت دارد که آدرس دقیقاً با مقدار iPAddress در subjectAltName گواهی‌نامه برابر باشد.
